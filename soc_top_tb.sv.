module soc_top_tb;

    reg clk = 0;
    reg rst_n;
    reg [31:0] bus_addr;
    reg [31:0] bus_wdata;
    reg bus_wr_en;
    reg bus_rd_en;
    reg [31:0] gpio_in;
    wire [31:0] bus_rdata;
    wire [31:0] gpio_out;

    // Instantiate SoC
    soc_top u_soc (
        .clk(clk),
        .rst_n(rst_n),
        .bus_addr(bus_addr),
        .bus_wdata(bus_wdata),
        .bus_wr_en(bus_wr_en),
        .bus_rd_en(bus_rd_en),
        .bus_rdata(bus_rdata),
        .gpio_in(gpio_in),
        .gpio_out(gpio_out)
    );

    // Clock generation
    always #5 clk = ~clk;

    initial begin
        rst_n = 0;
        bus_wr_en = 0;
        bus_rd_en = 0;
        gpio_in = 32'hA5A5A5A5; // example input
        #20 rst_n = 1;          // release reset

        // ------------------------
        // Write to DATA register
        // ------------------------
        bus_addr = 32'h4000_0000;
        bus_wdata = 32'h12345678;
        bus_wr_en = 1;
        #10 bus_wr_en = 0;

        // Read back DATA register
        bus_rd_en = 1;
        #10;
        if(bus_rdata == 32'h12345678)
            $display("PASS: Read DATA = %h", bus_rdata);
        else
            $display("FAIL: Read DATA = %h", bus_rdata);
        bus_rd_en = 0;

        // ------------------------
        // Write to DIR register
        // ------------------------
        bus_addr = 32'h4000_0004;
        bus_wdata = 32'hFFFFFFFF;
        bus_wr_en = 1;
        #10 bus_wr_en = 0;

        // Read GPIO_IN register
        bus_addr = 32'h4000_0008;
        bus_rd_en = 1;
        #10;
        if(bus_rdata == 32'hA5A5A5A5)
            $display("PASS: Read GPIO_IN = %h", bus_rdata);
        else
            $display("FAIL: Read GPIO_IN = %h", bus_rdata);
        bus_rd_en = 0;

        // Check GPIO output
        $display("GPIO Output = %h", gpio_out);

        $display("All tests finished");
        $finish;
    end

endmodule
